# Проект: Настройка K3D и Argo CD для CI/CD

## Описание

Данный проект посвящен развертыванию минималистичной версии Kubernetes с помощью K3D и настройке автоматического деплоя приложений через Argo CD. В рамках задания нужно создать инфраструктуру с двумя пространствами имен (`argocd` и `dev`) и настроить автоматическое развёртывание приложения из GitHub-репозитория.

---

## Структура проекта

- **K3D:** Локальная версия K3S, работающая внутри Docker.  
- **Argo CD:** Инструмент для автоматизации CI/CD процессов в Kubernetes.  
- **Namespaces:** 
  - `argocd`: для установки и работы Argo CD.  
  - `dev`: для автоматического деплоя приложений.  
- **Приложение:**  
  - Возможность использовать приложение Wil с Docker Hub или создать своё.  
  - Должны быть доступны две версии приложения (`v1` и `v2`).  

---

## Установка

### Предварительные требования

Перед началом убедитесь, что установлены следующие инструменты:

- Docker  
- K3D  
- `kubectl`  
- `lsof`

---

### Запуск скрипта

Для автоматической настройки инфраструктуры выполните команду:

```bash
./install.sh
```

## Что делает скрипт?

1. Проверяет существование кластера K3D и создаёт его при необходимости.
2. Создаёт пространства имён **argocd** и **dev**.
3. Устанавливает Argo CD и ожидает готовности всех подов.
4. Выводит пароль для авторизации в Argo CD.
5. Настраивает port-forward для доступа к Argo CD и сервисов приложения.
6. Применяет конфигурацию приложения для автоматического деплоя через Argo CD.

## Доступ к Argo CD

### После завершения установки:

Откройте браузер и перейдите по адресу:

```bash
https://localhost:8080
```

Используйте следующие данные для входа:
Логин: **admin**
Пароль: **будет выведен в консоль при запуске скрипта**.

## Проверка работы приложения

### Для доступа к развернутому приложению выполните команду:
```bash
kubectl port-forward svc/svc-wil 8888:8888 -n dev
```
После этого откройте браузер и перейдите по адресу:
```bash
http://localhost:8888
```
## Частые ошибки и их исправление

## Проблемы с портами

Если команда kubectl port-forward svc/svc-wil 8888:8888 -n dev не выполняется:
Убедитесь, что порт 8888 не занят.
Проверьте активные процессы, использующие порт, с помощью команды:
```bash
lsof -i :8888
```
Завершите процесс, который занимает порт:
```bash
kill <PID>
```
